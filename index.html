<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>School Diary Generator</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 480px;
        padding: 40px 35px;
        transition: all 0.4s ease;
      }

      .container.hidden {
        opacity: 0;
        transform: scale(0.95);
        pointer-events: none;
        position: absolute;
      }

      h1 {
        text-align: center;
        color: #2d3748;
        font-size: 28px;
        font-weight: 600;
        margin-bottom: 30px;
        letter-spacing: -0.5px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        color: #4a5568;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 15px;
        font-family: "Inter", sans-serif;
        color: #2d3748;
        transition: all 0.3s ease;
        background: #f7fafc;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      textarea {
        resize: vertical;
        min-height: 80px;
      }

      select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%234a5568' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 16px center;
        padding-right: 40px;
      }

      .btn {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        font-family: "Inter", sans-serif;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .result-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 600px;
        padding: 30px;
        text-align: center;
      }

      .result-card img {
        max-width: 100%;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .button-group {
        display: flex;
        gap: 12px;
        margin-top: 20px;
      }

      .btn-secondary {
        flex: 1;
        background: #f7fafc;
        color: #4a5568;
        border: 2px solid #e2e8f0;
      }

      .btn-secondary:hover {
        background: #edf2f7;
        border-color: #cbd5e0;
      }

      .btn-download {
        flex: 1;
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
      }

      .btn-download:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(72, 187, 120, 0.5);
      }

      .loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .footer {
        position: fixed;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        color: rgba(255, 255, 255, 0.8);
        font-size: 13px;
        font-weight: 300;
      }

      /* Responsive */
      @media (max-width: 640px) {
        .container,
        .result-card {
          padding: 30px 25px;
        }

        h1 {
          font-size: 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="loader" id="loader">
      <div class="spinner"></div>
    </div>

    <div class="container" id="formSection">
      <h1>üìö School Diary</h1>
      <form id="diaryForm">
        <div class="form-group">
          <label for="class">Class</label>
          <select id="class" required>
            <option value="">Select class</option>
            <option value="STD.I (Orchid & Camellia)">STD.I (Orchid & Camellia)</option>
            <option value="STD.II (Daffodil & Daisy)">STD.II (Daffodil & Daisy)</option>
            <option value="STD.III (Magnolia & Gardenia)">STD.III (Magnolia & Gardenia)</option>
            <option value="STD.IV (Lavender)">STD.IV (Lavender)</option>
            <option value="STD.V (Azalea)">STD.V (Azalea)</option>
            <option value="STD.VI (Iris)">STD.VI (Iris)</option>
            <option value="STD.VII (Aster)">STD.VII (Aster)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="subject">Subject</label>
          <select id="subject" required>
            <option value="">Select subject</option>
            <option value="Music">Music</option>
            <option value="Bangla">Bangla</option>
            <option value="Art & Craft">Art & Craft</option>
            <option value="Value Education">Value Education</option>
            <option value="English">English</option>
            <option value="Mathematics">Mathematics</option>
            <option value="Science">Science</option>
            <option value="Global English">Global English</option>
            <option value="Physics">Physics</option>
            <option value="BGST">BGST</option>
            <option value="ICT">ICT</option>
            <option value="Chemistry">Chemistry</option>
            <option value="Biology">Biology</option>
            <option value="Primary English">Primary English</option>
            <option value="Mathematics D">Mathematics D</option>
            <option value="Mathematics Additional">Mathematics Additional</option>
            <option value="Global Citizenship">Global Citizenship</option>
            <option value="Global Perspective">Global Perspective</option>
            <option value="Global Perspective & Global Citizenship">Global Perspective & Global Citizenship</option>
          </select>
        </div>

        <div class="form-group">
          <label for="teacher">Teacher Name</label>
          <input type="text" id="teacher" placeholder="Enter teacher name" required />
        </div>

        <div class="form-group">
          <label for="classwork">Classwork</label>
          <textarea id="classwork" placeholder="Enter classwork details" required></textarea>
        </div>

        <div class="form-group">
          <label for="homework">Homework</label>
          <textarea id="homework" placeholder="Leave blank if none"></textarea>
        </div>

        <div class="form-group">
          <label for="remarks">Remarks</label>
          <input type="text" id="remarks" placeholder="Enter remarks" value="N/A" required />
        </div>

        <button type="submit" class="btn btn-primary">Generate Diary</button>
      </form>
    </div>

    <div class="container result-card hidden" id="resultSection">
      <img id="diaryImage" alt="Generated Diary" />
      <div class="button-group">
        <button class="btn btn-secondary" id="backBtn">‚Üê Back</button>
        <button class="btn btn-download" id="downloadBtn">Download</button>
      </div>
    </div>

    <div class="footer" id="footer"></div>

    <script>
      // Elements
      const form = document.getElementById("diaryForm");
      const formSection = document.getElementById("formSection");
      const resultSection = document.getElementById("resultSection");
      const diaryImage = document.getElementById("diaryImage");
      const loader = document.getElementById("loader");
      const backBtn = document.getElementById("backBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const teacherInput = document.getElementById("teacher");
      const footer = document.getElementById("footer");

      // Set footer
      footer.textContent = `¬© ${new Date().getFullYear()} Nabila - All Rights Reserved`;

      // Teacher autocomplete
      let lastTeacher = "Nabila Tabassum";
      teacherInput.addEventListener("input", function (e) {
        if (e.target.value.toLowerCase() === "na") {
          e.target.value = "Nabila Tabassum";
        }
      });

      // Form submission
      form.addEventListener("submit", async function (e) {
        e.preventDefault();
        loader.style.display = "flex";

        const teacherName = teacherInput.value || "Nabila Tabassum";
        lastTeacher = teacherName;

        const data = {
          cls: document.getElementById("class").value,
          subject: document.getElementById("subject").value,
          teacher: teacherName,
          cw: document.getElementById("classwork").value,
          hw: document.getElementById("homework").value,
          remark: document.getElementById("remarks").value,
        };

        setTimeout(() => generateDiary(data), 100);
      });

      // Generate diary image
      async function generateDiary(data) {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        const bg = new Image();
        bg.crossOrigin = "anonymous";

        const currentDate = new Date();
        const day = String(currentDate.getDate()).padStart(2, "0");
        const month = String(currentDate.getMonth() + 1).padStart(2, "0");
        const year = currentDate.getFullYear();
        const dayName = currentDate.toLocaleString("en-US", { weekday: "long" });
        const dateText = `Date: ${day}.${month}.${year} (${dayName})`;

        function wrapText(context, text, x, y, maxWidth, lineHeight) {
          const lines = text.split("\n");
          lines.forEach((line) => {
            const words = line.split(" ");
            let currentLine = "";
            for (let n = 0; n < words.length; n++) {
              const testLine = currentLine + words[n] + " ";
              const metrics = context.measureText(testLine);
              if (metrics.width > maxWidth && n > 0) {
                context.fillText(currentLine, x, y);
                currentLine = words[n] + " ";
                y += lineHeight;
              } else {
                currentLine = testLine;
              }
            }
            context.fillText(currentLine, x, y);
            y += lineHeight;
          });
        }

        try {
          if (data.hw && data.hw.trim() !== "") {
            bg.src = "bg-v2.jpg";
            await new Promise((resolve, reject) => {
              bg.onload = resolve;
              bg.onerror = reject;
            });

            canvas.width = bg.width;
            canvas.height = bg.height;
            ctx.drawImage(bg, 0, 0);

            ctx.font = "63px Arial";
            ctx.fillStyle = "#000000";
            ctx.textAlign = "start";

            ctx.fillText(data.cls, 375, 762);
            ctx.fillText(data.subject, 425, 892);
            ctx.fillText(data.teacher || "Nabila Tabassum", 695, 1018);
            wrapText(ctx, data.cw, 181, 1240, 2000, 70);
            wrapText(ctx, data.hw, 181, 1668, 2000, 70);
            wrapText(ctx, data.remark, 181, 2100, 2000, 70);

            ctx.textAlign = "center";
            ctx.fillText(dateText, bg.width - 800, 763);
          } else {
            bg.src = "bg.jpg";
            await new Promise((resolve, reject) => {
              bg.onload = resolve;
              bg.onerror = reject;
            });

            canvas.width = bg.width;
            canvas.height = bg.height;
            ctx.drawImage(bg, 0, 0);

            ctx.font = "63px Arial";
            ctx.fillStyle = "#000000";
            ctx.textAlign = "start";

            ctx.fillText(data.cls, 372, 772);
            ctx.fillText(data.subject, 422, 902);
            ctx.fillText(data.teacher || "Nabila Tabassum", 692, 1029);
            wrapText(ctx, data.cw, 179, 1227, 2000, 70);

            ctx.textAlign = "center";
            ctx.fillText(dateText, bg.width - 838, 775);
          }

          diaryImage.src = canvas.toDataURL("image/png");
          loader.style.display = "none";
          formSection.classList.add("hidden");
          resultSection.classList.remove("hidden");
        } catch (error) {
          console.error("Error:", error);
          alert("Error loading background image. Make sure 'bg.jpg' and 'bg-v2.jpg' are available.");
          loader.style.display = "none";
        }
      }

      // Back button
      backBtn.addEventListener("click", function () {
        resultSection.classList.add("hidden");
        formSection.classList.remove("hidden");
        document.getElementById("classwork").value = "";
        document.getElementById("homework").value = "";
        document.getElementById("remarks").value = "N/A";
        document.getElementById("teacher").value = lastTeacher;
      });

      // Download button
      downloadBtn.addEventListener("click", function () {
        const link = document.createElement("a");
        link.href = diaryImage.src;
        link.download = "school_diary.png";
        link.click();
      });
    </script>
  </body>
</html>
